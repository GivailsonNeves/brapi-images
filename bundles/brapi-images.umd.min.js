!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("brapi-images",["exports","@angular/common","@angular/core","rxjs","@angular/common/http"],t):t(e["brapi-images"]={},e.ng.common,e.ng.core,e.rxjs,e.ng.common.http)}(this,function(e,n,r,t,o){"use strict";var i=new r.InjectionToken("BrapiConfig"),u=function(){function a(e,t){this.config=e,this._http=t}return a.prototype.transform=function(o,i){var u=this;return console.log(o,i),new Promise(function(t,e){var n=window.localStorage.getItem(i+o);if(n)t(n);else{var r=null;a.auth?a.auth.isExpired()&&(r=u._loginRefresh()):r=u._logInApi(),r?r.subscribe(function(e){u._requestImage(o,i).subscribe(function(e){return t(e)},function(e){return t("")})},function(e){t("")}):u._requestImage(o,i).subscribe(function(e){return t(e)},function(e){return t("")})}})},a.prototype._requestImage=function(r,e){var o=this;return t.Observable.create(function(t){var n="pesquisarPorSku",e={medida:o.config.defaultSize,proposito:o.config.proposito};"ean"==n?(n="pesquisarPorEan",e.eans=[r]):e.skus=[r],o._http.post(o.config.pathApi+"api/"+n,e,{headers:{Authorization:a.auth.token_type+" "+a.auth.access_token}}).subscribe(function(e){e&&e.length?(window.localStorage.setItem(n+r,e[0].url),t.next(e[0].url)):t.next("")},function(e){return t.next("")})})},a.prototype._logInApi=function(){var e=this;return t.Observable.create(function(t){e._http.post(e.config.pathApi+"api/login",{username:e.config.userName,password:e.config.password}).subscribe(function(e){a.auth=s.fromData(e),t.next()},function(e){console.error(e),t.error(e)})})},a.prototype._loginRefresh=function(){var e=this;return t.Observable.create(function(t){e._http.post(e.config.pathApi+"/oauth/refresh_token",{grant_type:"refresh_token",refresh_token:a.auth.refresh_token}).subscribe(function(e){a.auth=s.fromData(e),t.next()},function(e){console.error(e),t.error(e)})})},a.auth=null,a.decorators=[{type:r.Pipe,args:[{name:"productImage"}]}],a.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Inject,args:[i]}]},{type:o.HttpClient}]},a}(),s=function(){function e(){}return e.fromData=function(e){var t=e;return t.expireIn=1e3*t.expireIn+(new Date).getTime(),t},e.prototype.isExpired=function(){return(new Date).getTime()>=this.expireIn-3e4},e}(),a=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[u,{provide:i,useValue:e}]}},t.decorators=[{type:r.NgModule,args:[{declarations:[u],exports:[u],imports:[n.CommonModule,o.HttpClientModule]}]}],t}();e.BrapiImagesModule=a,e.ɵc=i,e.ɵa=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=brapi-images.umd.min.js.map